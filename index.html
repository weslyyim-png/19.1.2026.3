<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ±åº—æ•¸å­¸é¡Œäº’å‹•æ•™å­¸ (GitHubç‰ˆ)</title>
    <style>
        :root {
            --sky-50: #f0f9ff;
            --sky-100: #e0f2fe;
            --sky-200: #bae6fd;
            --sky-400: #38bdf8;
            --sky-500: #0ea5e9;
            --sky-600: #0284c7;
            --sky-700: #0369a1;
            
            --rose-100: #ffe4e6;
            --rose-400: #fb7185;
            --rose-500: #f43f5e;
            --rose-600: #e11d48;
            
            --green-100: #dcfce7;
            --green-300: #86efac;
            --green-500: #22c55e;
            --green-600: #16a34a;
            --green-700: #15803d;

            --orange-50: #fff7ed;
            --orange-100: #ffedd5;
            --orange-400: #fb923c;
            --orange-500: #f97316;

            --purple-500: #a855f7;
            --purple-600: #9333ea;

            --yellow-100: #fef9c3;
            --yellow-300: #fde047;
            --yellow-700: #a16207;
            --yellow-800: #854d0e;

            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--sky-50);
            color: var(--gray-800);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Utility Classes replacement */
        .container {
            width: 100%;
            max-width: 900px;
        }

        .card {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .card {
                flex-direction: row;
                min-height: 500px;
            }
        }

        .header {
            background-color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            text-align: center;
            border-bottom: 4px solid var(--sky-400);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: var(--sky-600);
            margin: 0 0 8px 0;
            font-size: 1.5rem;
        }

        @media (min-width: 768px) {
            .header h1 { font-size: 1.875rem; }
        }

        .text-lg { font-size: 1.125rem; }
        .text-gray-600 { color: var(--gray-600); }
        .text-rose-600 { color: var(--rose-600); }
        .font-bold { font-weight: 700; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mr-2 { margin-right: 0.5rem; }
        
        /* Layout Sections */
        .left-panel {
            width: 100%;
            background-color: var(--sky-100);
            padding: 16px;
            border-bottom: 1px solid var(--sky-200);
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .left-panel {
                width: 50%;
                border-bottom: none;
                border-right: 1px solid var(--sky-200);
            }
        }

        .right-panel {
            width: 100%;
            padding: 24px;
            background-color: white;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .right-panel { width: 50%; }
        }

        /* Visualization Elements */
        .shelf {
            background-color: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            min-height: 120px;
        }
        
        .bouquet-grid {
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
        }

        .bouquet-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 4px;
            transition: transform 0.3s;
        }
        
        .bouquet-item:hover {
            transform: scale(1.1);
        }

        .flower-icon {
            position: relative;
        }
        
        .flower-count-badge {
            position: absolute;
            bottom: -4px;
            right: -4px;
            background-color: var(--green-500);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 0 4px;
            border-radius: 9999px;
        }

        .workspace {
            background-color: var(--orange-50);
            border-radius: 12px;
            padding: 16px;
            flex-grow: 1;
            border: 1px solid var(--orange-100);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            position: relative;
        }

        .loose-bin {
            width: 33%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .loose-circle {
            background-color: var(--rose-100);
            border: 4px solid var(--rose-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s;
            overflow: hidden;
        }

        .loose-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--rose-500);
            z-index: 10;
        }

        .arrow-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 32px;
        }

        /* Interaction Elements */
        .feedback {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 12px;
            text-align: center;
            font-size: 0.875rem;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .feedback.neutral { background-color: var(--gray-100); color: var(--gray-600); }
        .feedback.success { background-color: var(--green-100); color: var(--green-700); }
        .feedback.error { background-color: var(--rose-100); color: var(--rose-600); }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: bold;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn:hover { transform: scale(1.02); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background-color: var(--gray-300); cursor: not-allowed; transform: none; }

        .btn-purple { background-color: var(--purple-500); }
        .btn-purple:hover { background-color: var(--purple-600); }
        
        .btn-sky { background-color: var(--sky-500); }
        .btn-sky:hover { background-color: var(--sky-600); }

        .btn-green { background-color: var(--green-500); }
        .btn-green:hover { background-color: var(--green-600); }

        .input-group {
            background-color: var(--gray-50);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .input-num {
            width: 80px;
            padding: 8px;
            text-align: center;
            font-size: 1.25rem;
            font-weight: bold;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            outline: none;
        }

        .input-num:focus { border-color: var(--sky-500); }
        .input-num.result { background-color: var(--sky-50); border-color: var(--sky-300); color: var(--sky-700); }
        .input-num.result-green { background-color: var(--green-100); border-color: var(--green-300); color: var(--green-700); }

        .step-label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .step-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 8px;
        }

        .step-title {
            font-size: 1.125rem;
            font-weight: bold;
            color: var(--gray-600);
        }

        .final-msg {
            text-align: center;
            background-color: var(--yellow-100);
            border: 2px solid var(--yellow-300);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            animation: zoomIn 0.5s;
        }

        .equation-box {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(161, 98, 7, 0.2);
        }
        
        .equation-text {
            font-family: monospace;
            font-size: 1.25rem;
            background-color: rgba(255,255,255,0.6);
            padding: 8px;
            border-radius: 8px;
            display: inline-block;
            color: var(--yellow-800);
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-slideUp { animation: slideUp 0.5s ease-out; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s; }
        
        .footer {
            margin-top: 32px;
            color: var(--gray-400);
            font-size: 0.875rem;
        }

        /* Reset Button */
        .reset-link {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            text-decoration: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-100);
            cursor: pointer;
            font-size: 0.875rem;
        }
        .reset-link:hover { color: var(--gray-600); }

        /* Icon SVGs as background or content */
        .icon { width: 24px; height: 24px; display: inline-block; vertical-align: middle; }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>ğŸŒ¹ èŠ±åº—ç«ç‘°æ•¸å­¸é¡Œ ğŸŒ¹</h1>
            <p class="text-lg text-gray-600">
                é¡Œç›®ï¼šåŸæœ‰ <strong>11</strong> æŸï¼Œåº—å“¡å†æŠŠ <strong>156</strong> æç«ç‘°åŒ…è£æˆæ¯ <strong>12</strong> æä¸€æŸï¼ŒèŠ±åº—ç¾æœ‰ç«ç‘°å¤šå°‘æŸï¼Ÿ
            </p>
        </header>

        <!-- Main Card -->
        <div class="card">
            
            <!-- Left: Visualization -->
            <div class="left-panel">
                <h3 class="text-lg font-bold" style="color: var(--sky-700); margin-bottom: 16px; display: flex; align-items: center;">
                    <span id="icon-package" class="mr-2"></span> èŠ±åº—ç¾å ´
                </h3>

                <!-- Top Shelf -->
                <div class="shelf">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span class="text-gray-600 font-bold" style="font-size: 0.875rem;">åŸæœ‰èŠ±æŸ (11æŸ)</span>
                        <span id="total-badge" class="font-bold hidden" style="color: var(--green-600); font-size: 0.875rem;">ç¸½å…± 24 æŸ!</span>
                    </div>
                    <div id="shelf-content" class="bouquet-grid">
                        <!-- Original Bouquets injected by JS -->
                    </div>
                </div>

                <!-- Bottom Workspace -->
                <div class="workspace">
                    <span style="position: absolute; top: 12px; left: 16px; color: var(--orange-400); font-weight: bold; font-size: 0.875rem;">åŒ…è£å·¥ä½œå°</span>
                    
                    <!-- Loose Bin -->
                    <div class="loose-bin">
                        <div id="loose-circle" class="loose-circle" style="width: 100px; height: 100px;">
                            <!-- Flower Pattern Overlay done with CSS/SVG in JS -->
                            <span id="loose-count" class="loose-count">156</span>
                            <span style="position: absolute; bottom: 10px; font-size: 0.75rem; color: var(--rose-400);">ææ•£è£</span>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="arrow-area">
                        <div id="packing-indicator" class="hidden" style="display: flex; gap: 4px;">
                            <div style="width: 8px; height: 8px; background: var(--orange-400); border-radius: 50%;" class="animate-pulse"></div>
                            <div style="width: 8px; height: 8px; background: var(--orange-400); border-radius: 50%;" class="animate-pulse" style="animation-delay: 0.1s"></div>
                            <div style="width: 8px; height: 8px; background: var(--orange-400); border-radius: 50%;" class="animate-pulse" style="animation-delay: 0.2s"></div>
                        </div>
                        <span id="static-arrow" style="font-size: 2rem; color: var(--gray-300);">â”</span>
                    </div>

                    <!-- New Bouquets -->
                    <div style="width: 33%; display: flex; flex-direction: column; align-items: center; min-height: 100px; justify-content: flex-end;">
                        <div id="new-bouquets-area" class="bouquet-grid" style="justify-content: center; align-items: flex-end;"></div>
                        <span id="new-label" class="text-rose-600 font-bold" style="margin-top: 8px; font-size: 0.875rem;">0 æŸ (æ–°)</span>
                        <span id="moved-label" class="text-gray-600 hidden" style="margin-top: 8px; font-size: 0.875rem; font-style: italic;">å·²ç§»è‡³ä¸Šæ–¹</span>
                    </div>
                </div>
            </div>

            <!-- Right: Interaction -->
            <div class="right-panel">
                <div id="feedback" class="feedback neutral">è«‹é¸æ“‡æ¨¡å¼é–‹å§‹</div>

                <div style="margin-top: 48px; flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                    
                    <!-- Menu View -->
                    <div id="view-menu">
                        <button onclick="startDemo()" class="btn btn-purple">
                            <span class="icon mr-2" id="icon-play"></span> è‡ªå‹•æ¼”ç¤º (çœ‹è€å¸«åš)
                        </button>
                        <button onclick="startInteractive()" class="btn btn-sky">
                            <span class="icon mr-2" id="icon-calc"></span> äº’å‹•è§£é¡Œ (æˆ‘è‡ªå·±åš)
                        </button>
                    </div>

                    <!-- Step 1 View -->
                    <div id="view-step1" class="hidden fade-in">
                        <div class="step-label">
                            <div class="step-badge" style="background-color: var(--sky-500);">1</div>
                            <span class="step-title">å…ˆç®—ï¼š156 æå¯ä»¥åŒ…æˆå¹¾æŸï¼Ÿ</span>
                        </div>
                        <div class="input-group">
                            <input type="number" id="in-div-1" class="input-num" placeholder="?">
                            <span style="font-size: 1.5rem; color: var(--gray-400);">Ã·</span>
                            <input type="number" id="in-div-2" class="input-num" style="width: 60px;" placeholder="?">
                            <span style="font-size: 1.5rem; color: var(--gray-400);">=</span>
                            <input type="number" id="in-div-ans" class="input-num result" placeholder="?">
                            <span class="font-bold text-gray-600">æŸ</span>
                        </div>
                        <button id="btn-check-1" onclick="checkStep1()" class="btn btn-sky">æª¢æŸ¥ç­”æ¡ˆ & åŒ…è£</button>
                    </div>

                    <div id="divider" class="hidden" style="height: 1px; background-color: var(--gray-200); margin: 24px 0;"></div>

                    <!-- Step 2 View -->
                    <div id="view-step2" class="hidden animate-slideUp">
                        <div class="step-label">
                            <div class="step-badge" style="background-color: var(--green-500);">2</div>
                            <span class="step-title">å†ç®—ï¼šç¾åœ¨ç¸½å…±æœ‰å¹¾æŸï¼Ÿ</span>
                        </div>
                        <div class="input-group">
                            <input type="number" id="in-add-1" class="input-num" style="width: 60px;" placeholder="?">
                            <span style="font-size: 1.5rem; color: var(--gray-400);">+</span>
                            <input type="number" id="in-add-2" class="input-num" style="width: 60px;" placeholder="?">
                            <span style="font-size: 1.5rem; color: var(--gray-400);">=</span>
                            <input type="number" id="in-add-ans" class="input-num result-green" placeholder="?">
                            <span class="font-bold text-gray-600">æŸ</span>
                        </div>
                        <button id="btn-check-2" onclick="checkStep2()" class="btn btn-green">æª¢æŸ¥æœ€çµ‚ç­”æ¡ˆ</button>

                        <div id="final-success" class="final-msg hidden">
                            <h2 style="font-size: 1.5rem; color: var(--yellow-700); margin: 0 0 4px 0;">ğŸ‰ ç­”å°äº†ï¼</h2>
                            <p style="color: var(--yellow-800); font-weight: 500;">èŠ±åº—ç¾åœ¨å…±æœ‰ 24 æŸç«ç‘°ï¼</p>
                            <div class="equation-box">
                                <p style="font-size: 0.875rem; font-weight: bold; color: rgba(133, 77, 14, 0.8); margin-bottom: 8px;">å®Œæ•´åˆ—å¼ï¼š</p>
                                <div class="equation-text">11 + (156 Ã· 12) = 24</div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Footer / Reset -->
                <div id="reset-area" class="hidden">
                    <a onclick="resetGame()" class="reset-link">
                        <span class="icon mr-2" id="icon-reset"></span> å›ä¸»é¸å–®
                    </a>
                </div>
            </div>
        </div>

        <div class="footer">å°ˆç‚ºå°å­¸ç”Ÿè¨­è¨ˆçš„æ•¸å­¸äº’å‹•æ•™å­¸</div>
    </div>

    <!-- Logic Script -->
    <script>
        // Icons (SVG Strings)
        const SVGS = {
            play: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`,
            calc: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></svg>`,
            package: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16.5 9.4-9-5.19"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>`,
            reset: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 5v7h7" /></svg>`
        };

        function getFlowerSVG(colorClass) {
            let color = '#f43f5e'; // rose-500
            if(colorClass === 'text-rose-400') color = '#fb7185';
            if(colorClass === 'text-rose-600') color = '#e11d48';
            
            return `<div class="bouquet-item">
                <div style="position: relative; color: ${color};">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5z"/><path d="M12 7.5V3"/><path d="M12 21v-4.5"/><path d="M16.5 12H21"/><path d="M3 12h4.5"/><path d="M15.18 8.82 18.36 5.64"/><path d="M5.64 18.36l3.18-3.18"/><path d="M15.18 15.18l3.18 3.18"/><path d="M5.64 5.64l3.18 3.18"/></svg>
                    <div class="flower-count-badge">12</div>
                </div>
            </div>`;
        }

        // State
        let state = {
            mode: 'menu', // menu, demo, interactive
            step: 1,
            originalBouquets: 11,
            currentLoose: 156,
            newBouquets: 0,
            isPacking: false,
            showFinal: false
        };

        // DOM Elements
        const els = {
            shelfContent: document.getElementById('shelf-content'),
            looseCount: document.getElementById('loose-count'),
            looseCircle: document.getElementById('loose-circle'),
            newBouquetsArea: document.getElementById('new-bouquets-area'),
            newLabel: document.getElementById('new-label'),
            movedLabel: document.getElementById('moved-label'),
            packingIndicator: document.getElementById('packing-indicator'),
            staticArrow: document.getElementById('static-arrow'),
            totalBadge: document.getElementById('total-badge'),
            feedback: document.getElementById('feedback'),
            viewMenu: document.getElementById('view-menu'),
            viewStep1: document.getElementById('view-step1'),
            viewStep2: document.getElementById('view-step2'),
            divider: document.getElementById('divider'),
            resetArea: document.getElementById('reset-area'),
            btnCheck1: document.getElementById('btn-check-1'),
            btnCheck2: document.getElementById('btn-check-2'),
            finalSuccess: document.getElementById('final-success'),
            // Inputs
            inDiv1: document.getElementById('in-div-1'),
            inDiv2: document.getElementById('in-div-2'),
            inDivAns: document.getElementById('in-div-ans'),
            inAdd1: document.getElementById('in-add-1'),
            inAdd2: document.getElementById('in-add-2'),
            inAddAns: document.getElementById('in-add-ans'),
        };

        // Init
        function init() {
            // Inject Icons
            document.getElementById('icon-play').innerHTML = SVGS.play;
            document.getElementById('icon-calc').innerHTML = SVGS.calc;
            document.getElementById('icon-package').innerHTML = SVGS.package;
            document.getElementById('icon-reset').innerHTML = SVGS.reset;

            renderOriginalBouquets();
        }

        function renderOriginalBouquets() {
            els.shelfContent.innerHTML = '';
            for(let i=0; i<state.originalBouquets; i++) {
                els.shelfContent.innerHTML += getFlowerSVG('text-rose-400');
            }
        }

        function setFeedback(msg, type = 'neutral') {
            els.feedback.textContent = msg;
            els.feedback.className = `feedback ${type}`;
        }

        function resetGame() {
            state = {
                mode: 'menu',
                step: 1,
                originalBouquets: 11,
                currentLoose: 156,
                newBouquets: 0,
                isPacking: false,
                showFinal: false
            };
            
            // Clear inputs
            const inputs = document.querySelectorAll('input');
            inputs.forEach(i => { i.value = ''; i.readOnly = false; });
            
            // Reset visual elements
            renderOriginalBouquets();
            els.newBouquetsArea.innerHTML = '';
            updateLooseVisuals();
            els.newLabel.textContent = '0 æŸ (æ–°)';
            els.newLabel.classList.remove('hidden');
            els.movedLabel.classList.add('hidden');
            els.totalBadge.classList.add('hidden');
            els.finalSuccess.classList.add('hidden');

            // Hide/Show Views
            els.viewMenu.classList.remove('hidden');
            els.viewStep1.classList.add('hidden');
            els.viewStep2.classList.add('hidden');
            els.divider.classList.add('hidden');
            els.resetArea.classList.add('hidden');
            els.btnCheck1.classList.remove('hidden');
            els.btnCheck2.classList.remove('hidden');
            
            setFeedback('è«‹é¸æ“‡æ¨¡å¼é–‹å§‹');
        }

        function updateLooseVisuals() {
            els.looseCount.textContent = state.currentLoose;
            // Scale effect
            const scale = 0.5 + (state.currentLoose / 156) * 0.5;
            els.looseCircle.style.transform = `scale(${scale})`;
        }

        function updateNewBouquetsVisuals() {
            // Re-render new bouquets
            let html = '';
            for(let i=0; i<state.newBouquets; i++) {
                html += getFlowerSVG('text-rose-600');
            }
            els.newBouquetsArea.innerHTML = html;
            els.newLabel.textContent = `${state.newBouquets} æŸ (æ–°)`;
        }

        function startInteractive() {
            state.mode = 'interactive';
            els.viewMenu.classList.add('hidden');
            els.viewStep1.classList.remove('hidden');
            els.resetArea.classList.remove('hidden');
            setFeedback('ç¬¬ä¸€æ­¥ï¼šè«‹è¼¸å…¥ç®—å¼ï¼Œ156 ææ¯ 12 æä¸€æŸã€‚');
        }

        function startDemo() {
            state.mode = 'demo';
            els.viewMenu.classList.add('hidden');
            els.viewStep1.classList.remove('hidden');
            els.resetArea.classList.remove('hidden');
            // Hide interactive buttons
            els.btnCheck1.classList.add('hidden');
            els.btnCheck2.classList.add('hidden');
            
            // Set inputs to readonly
            document.querySelectorAll('input').forEach(i => i.readOnly = true);

            runDemoSequence();
        }

        async function runDemoSequence() {
            setFeedback('é¡Œç›®ï¼šèŠ±åº—è£åŸæœ‰ç«ç‘° 11 æŸï¼Œå°‡ 156 ææ•£è£ç«ç‘°æ¯ 12 æåŒ…æˆä¸€æŸ...');
            await wait(3500);

            setFeedback('ç¬¬ä¸€æ­¥ï¼šè¨ˆç®—æ•£è£ç«ç‘°å¯ä»¥åŒ…æˆå¹¾æŸï¼Ÿ (156 Ã· 12)');
            await wait(1000);

            // Animation: Packing
            els.staticArrow.classList.add('hidden');
            els.packingIndicator.classList.remove('hidden');

            let packInterval = setInterval(() => {
                if (state.currentLoose >= 12) {
                    state.currentLoose -= 12;
                    state.newBouquets += 1;
                    updateLooseVisuals();
                    updateNewBouquetsVisuals();
                } else {
                    clearInterval(packInterval);
                    els.packingIndicator.classList.add('hidden');
                    els.staticArrow.classList.remove('hidden');
                    finishStep1Demo();
                }
            }, 600);
        }

        async function finishStep1Demo() {
            setFeedback('åŒ…è£å®Œæˆï¼æˆ‘å€‘å¾—åˆ°äº† 13 æŸæ–°ç«ç‘°ã€‚');
            
            // Fill inputs slowly
            await wait(1000);
            els.inDiv1.value = 156;
            await wait(800);
            els.inDiv2.value = 12;
            await wait(800);
            els.inDivAns.value = 13;
            
            await wait(3000);
            
            // Transition to Step 2
            els.divider.classList.remove('hidden');
            els.viewStep2.classList.remove('hidden');
            // Auto scroll
            els.viewStep2.scrollIntoView({ behavior: 'smooth' });

            setFeedback('ç¬¬äºŒæ­¥ï¼šå°‡åŸæœ¬çš„ 11 æŸåŠ ä¸Šæ–°åŒ…å¥½çš„ 13 æŸã€‚');
            
            // Move bouquets visually (Simple fake move: clear bottom, add to top)
            els.newLabel.classList.add('hidden');
            els.movedLabel.classList.remove('hidden');
            els.newBouquetsArea.innerHTML = ''; // Hide from bottom
            // Add to top
            for(let i=0; i<13; i++) {
                els.shelfContent.innerHTML += `<div class="fade-in">${getFlowerSVG('text-rose-600')}</div>`;
            }

            await wait(2500);

            // Fill inputs
            els.inAdd1.value = 11;
            await wait(1000);
            els.inAdd2.value = 13;
            await wait(1000);
            
            // Show result
            els.finalSuccess.classList.remove('hidden');
            els.totalBadge.classList.remove('hidden');
            els.inAddAns.value = 24;
            setFeedback('ç­”æ¡ˆç®—å‡ºï¼šç¸½å…±æœ‰ 24 æŸç«ç‘°ï¼', 'success');
        }

        function checkStep1() {
            const v1 = parseInt(els.inDiv1.value);
            const v2 = parseInt(els.inDiv2.value);
            const ans = parseInt(els.inDivAns.value);

            if (v1 === 156 && v2 === 12 && ans === 13) {
                setFeedback('ç­”å°äº†ï¼156 é™¤ä»¥ 12 ç­‰æ–¼ 13 æŸã€‚', 'success');
                els.btnCheck1.disabled = true;
                
                // Animation
                els.staticArrow.classList.add('hidden');
                els.packingIndicator.classList.remove('hidden');
                
                let packInterval = setInterval(() => {
                    if (state.currentLoose >= 12) {
                        state.currentLoose -= 12;
                        state.newBouquets += 1;
                        updateLooseVisuals();
                        updateNewBouquetsVisuals();
                    } else {
                        clearInterval(packInterval);
                        els.packingIndicator.classList.add('hidden');
                        els.staticArrow.classList.remove('hidden');
                        
                        setTimeout(() => {
                            state.step = 2;
                            els.divider.classList.remove('hidden');
                            els.viewStep2.classList.remove('hidden');
                            els.viewStep2.scrollIntoView({ behavior: 'smooth' });
                            setFeedback('ç¾åœ¨é€²å…¥ç¬¬äºŒæ­¥ï¼Œè¨ˆç®—ç¸½æ•¸ã€‚');
                            
                            // Move visuals logic for interactive mode
                             els.newLabel.classList.add('hidden');
                             els.movedLabel.classList.remove('hidden');
                             els.newBouquetsArea.innerHTML = '';
                             for(let i=0; i<13; i++) {
                                els.shelfContent.innerHTML += `<div class="fade-in">${getFlowerSVG('text-rose-600')}</div>`;
                             }

                        }, 1000);
                    }
                }, 50); // Fast for interactive
            } else {
                setFeedback('ç®—å¼å¥½åƒä¸å¤ªå°å–”ï¼Ÿè©¦è©¦çœ‹ï¼š156 æï¼Œæ¯ 12 æä¸€æŸã€‚', 'error');
            }
        }

        function checkStep2() {
            const v1 = parseInt(els.inAdd1.value);
            const v2 = parseInt(els.inAdd2.value);
            const ans = parseInt(els.inAddAns.value);

            if (
                ((v1 === 11 && v2 === 13) || (v1 === 13 && v2 === 11)) && ans === 24
            ) {
                setFeedback('å¤ªæ£’äº†ï¼å®Œå…¨æ­£ç¢ºï¼ç¾æœ‰ 24 æŸç«ç‘°ã€‚', 'success');
                els.finalSuccess.classList.remove('hidden');
                els.totalBadge.classList.remove('hidden');
                els.btnCheck2.disabled = true;
            } else {
                setFeedback('å†æƒ³ä¸€æƒ³ï¼ŒåŸæœ‰ 11 æŸï¼ŒåŠ ä¸Šæ–°åŒ…å¥½çš„ 13 æŸ...', 'error');
            }
        }

        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // Start
        init();

    </script>
</body>
</html>
